{% extends "base.html" %}
{% block content %}
    <div style="text-align: center;">
        <h1 style="color: #10b2f7; font-size: xx-large; font-family: serif; font-weight: bold;">{{ fictionchapter.title }}</h1>
        <a href="{% url 'fiction_fans:chapter_edit' fictionchapter.fiction_title_id fictionchapter.id %}">
            <button style="background-color:rgb(236, 155, 25); border: 3px solid #ed0e0e;">Edit</button>
        </a>
        <a href="{% url 'fiction_fans:chapter_del' fictionchapter.fiction_title_id fictionchapter.id %}">
            <button style="background-color:rgb(255, 0, 0); border: 3px solid #00000000;">Delete</button>
        </a>
    </div>
<br>
<div class="flex-container">
    <div id="content" class="block" style="min-width:1000px; min-height:500px">
        <section id="chapter-body"></section>
        <script>
            window.addEventListener(
                "DOMContentLoaded", () => {
                    const chapterBody = document.getElementById("chapter-body");
                    console.log("{{ fictionchapter.content | escapejs }}");
                    let body = JSON.parse("{{ fictionchapter.content | escapejs }}");
                    let block = body.blocks;
                    console.log(block.length);
                    for (let i = 0; i <= block.length; i++) {
                        console.log(block[i], i);
                        switch (block[i].type) {
                            case "Header":
                                let head = document.createElement(`h${block[i].data.level}`);
                                head.textContent = block[i].data.text;
                                chapterBody.appendChild(head);
                                break;
                            case "Image":
                                let div = document.createElement("div");
                                let image = document.createElement("img");
                                let caption = document.createElement("small");
                                image.src = `${block[i].data.file.url}`;
                                image.style = "margin-top:10px;";
                                image.height = 200;
                                image.width = 200;
                                caption.textContent = block[i].data.caption;
                                caption.style = "margin-top:5px;";
                                div.appendChild(image);
                                div.appendChild(caption);
                                div.style = "width:39%;display:grid;place-items:center";
                                chapterBody.appendChild(div);
                                break;
                            case "paragraph":
                                const text = document.createElement("p");
                                text.innerHTML = block[i].data.text;
                                chapterBody.appendChild(text);
                                break;
                            default:
                                break;
                        }
                    }
                }
            );
        </script>
    </div>
    <div>
        <div  id="content" class="scroll_view" style="background-color: aquamarine;">
            {% for comment in fictionchapter.comment_set.all %}
            <div>
                <h1 style="color: darkblue;">{{ comment.user.get_username }}</h1>
                <p style="color: darkcyan;">{{ comment.text }}</p>
                <div style="text-align: right;">
                    <date style="color:blueviolet; ">{{ comment.comment_date }}</date>
                </div>
                <br>
            </div>
            {% endfor %}
        </div>
        <div style="background-color: blanchedalmond; width: 500px; height: 300px;">
            <form action="{% url 'fiction_fans:chapter_comment'  fictionchapter.fiction_title_id fictionchapter.id %}" method="post">
            {% csrf_token %}
                <fieldset style="text-align: center;">
                <h1 style="font-size: larger; font-weight:bold; font-family: cursive; color:#9e550c">comment session</h1>
                <textarea id="comment_text" name="comment_text" rows="8" cols="50"></textarea>
                <br>
                <input type="submit" value="comment" style="background-color:rgb(209, 133, 10); border: 3px solid #9e550c; color: #2a084d;">
                </fieldset>
            </form>
        </div>
    </div>
</div>
{% endblock content %}
